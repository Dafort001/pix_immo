# Buchungsseite pix.immo – Spezifikation v1

**Letzte Aktualisierung:** 18. November 2025  
**Status:** Implementiert, E2E-Tests noch anzupassen, sobald Logik final ist.

---

## 1. Zweck & Geltungsbereich

Die Buchungsseite dient zwei Einsatzzwecken:

1. **Admin-Interne Buchung**  
   - Route: `/admin/internal-booking`  
   - Nutzung: Admin legt im Namen eines Kunden einen Auftrag an.

2. **Kunden-Buchungsseite (später)**  
   - Route (Platzhalter): `/booking`  
   - UI und Logik sind weitgehend identisch, nur ohne Admin-spezifische Elemente.

Die Seite ermöglicht die Buchung von:

- Fotopaketen (F10, F15, F20, F40)
- Drohnenaufnahmen
- Video-Services (vorläufig)
- Virtuellen Rundgängen (TML)
- Optionaler Anfahrt über 40 km (nur nach Absprache, nicht automatisiert)
- Automatischer Preisberechnung (Netto / MwSt / Brutto)
- SMS-Benachrichtigung nach Auftragseingang

---

## 2. Zugriff & Berechtigungen

### 2.1 Admin-Interne Buchung

- **Route:** `/admin/internal-booking`
- **Navigation:** Admin-Sidebar → Services → „Buchen“
- **Berechtigung:** Nur für eingeloggte Admin-Benutzer (Role: `admin`)

### 2.2 Kundenseite (später)

- **Route (geplant):** `/booking`
- **Zugriff:**  
  - Entweder ohne Login mit Pflichtangabe von Kontaktdaten  
  - oder mit Kunden-Login (später definieren)
- Logik der Formularfelder ist identisch, nur ohne interne Admin-Hinweise.

---

## 3. Service-Logik – Übersicht

Die Buchungsseite zeigt eine Liste aller buchbaren Services aus dem Preiskatalog  
(z. B. `seed-services.ts` / `preise_piximmo_internal_*.md`).

### Kategorien (Beispiele)

- Fotopakete: F10, F15, F20, F40  
- Einzelfotos (Zusatzfoto FEX – **nicht aktiv buchbar**, nur dokumentiert)  
- Drohnenpakete  
- Video-Pakete (Platzhalter, später zu überarbeiten)  
- Virtuelle Rundgänge: TML  
- Bildbearbeitungs-/Optimierungsoptionen: nur dokumentiert, werden später in der Galerie auswählbar  
- Anfahrt: integriert in die Grundlogik, keine separate Service-Position

**Wichtig:**  
Regionen-Auswahl (HH/EXT/Berlin) entfällt vollständig. Es gibt **keine „Region“-Felder** mehr in der UI und keine Berlin-spezifischen Services. Anfahrt wird pauschal geregelt (siehe Abschnitt 7).

---

## 4. Fotopakete (F10 / F15 / F20 / F40)

### 4.1 Grundprinzip

- Es werden **immer mehr Bilder fotografiert**, als im gebuchten Paket enthalten sind.
- Der Kunde erhält später in der Galerie eine **Auswahl** der Bilder.
- Er kann daraus die im Paket enthaltene Anzahl **frei auswählen**.
- Jedes zusätzlich ausgewählte Bild wird als **Zusatzfoto (FEX)** abgerechnet.

Die Quadratmeterangaben dienen **nur als Orientierung**, es erfolgt **keine automatische technische Prüfung** im System.  
Der Kunde gibt in der Buchung **keine Quadratmeterzahl** an.  
Im Zweifelsfall entscheidet der Fotograf, ob das gewählte Paket realistisch ist.

### 4.2 Paketdefinitionen

#### F10 – 10 Bilder

- Enthalten: **10 final bearbeitete Bilder**
- Empfehlung: **bis ca. 60 m² Wohnfläche**
- Typisch für: 1–2 Zimmer-Wohnungen, kleine Apartments
- Aufnahmeumfang: ca. 15–20 Bilder, aus denen der Kunde 10 auswählt
- Mehrbilder möglich (FEX, siehe Abschnitt 5)

#### F15 – 15 Bilder

- Enthalten: **15 final bearbeitete Bilder**
- Empfehlung: **bis ca. 200 m²**
- Typisch für: normale Wohnungen, kleinere Häuser
- Es werden mehr Bilder aufgenommen als 15
- Mehrbilder möglich (FEX)

#### F20 – 20 Bilder

- Enthalten: **20 final bearbeitete Bilder**
- Empfehlung: **bis ca. 200 m²**
- Typisch für: größere Wohnungen, Reihenhäuser, mehr Raumvarianten
- Mehrbilder möglich (FEX)

#### F40 – 40 Bilder

- Enthalten: **40 final bearbeitete Bilder**
- Empfehlung: **bis ca. 300 m²**  
  oder Objekte mit **mehreren Wohneinheiten**
- Geeignet für:
  - Häuser mit Einliegerwohnung
  - Mehrere abgeschlossene Einheiten im selben Gebäude
  - Haus mit mehreren Apartments / Ebenen

---

## 5. Mehrere Wohneinheiten & Zusatzbilder (FEX)

### 5.1 Mehrere Einheiten

Wenn ein Objekt aus **mehr als einer Wohneinheit** besteht  
(z. B. Hauptwohnung + Einliegerwohnung, DG + EG als getrennte Einheiten, mehrere kleine Apartments):

- Ein einzelnes Paket F10/F15/F20 ist in der Regel **nicht ausreichend**.
- Empfohlen:
  - Entweder **zwei Pakete** buchen (z. B. F15 + F10)
  - Oder direkt **F40**, da dieses Paket für Mehr-Einheiten realistisch ist.

Diese Information wird auf der Buchungsseite klar kommuniziert.  
Die tatsächliche Entscheidung erfolgt im Zweifel durch den Fotografen.

### 5.2 Zusatzfoto (FEX)

- Bezeichnung intern: **FEX** (Zusatzbild)
- Preis: **6 € pro zusätzlichem Bild**
- Gilt sowohl für:
  - **Bodenfotografie** (normale Fotoaufnahmen)
  - **Drohnenfotografie**, sofern als Einzelbild abgerechnet wird
- Wichtig:
  - FEX ist **nicht als Buchungs-Service auf der Seite auswählbar**.
  - FEX wird nur dann ausgelöst, wenn der Kunde in der Galerie **mehr Bilder auswählt**, als im Paket enthalten sind.
  - Die FEX-Position muss in der Preisliste dokumentiert sein, aber in der Buchungsmaske **nicht sichtbar** sein.

---

## 6. Drohnenaufnahmen

Drohnen-Services funktionieren nach dem gleichen Grundprinzip wie die Fotopakete:

- Ein Drohnenpaket enthält eine bestimmte Anzahl finaler **Drohnenbilder**.
- Es werden in der Praxis **mehr Drohnenbilder** produziert als im Paket enthalten sind.
- Der Kunde wählt später in der Galerie seine finalen Drohnenbilder aus.
- **Zusätzliche Drohnenbilder** über das Paket hinaus werden wie FEX abgerechnet, sofern sie als Einzelbild gekauft werden (Preis: 6 € pro Zusatzbild).

**Wichtig:**  
Ob Zusatzbilder aus Boden- oder Drohnenaufnahmen stammen, ist für die Preislogik nicht relevant. Intern kann es dieselbe Zusatzbild-Position (FEX) sein, solange der Preis identisch ist.

---

## 7. Video-Services (vorläufig)

Es existieren Video-Services (z. B. Kurz, Mittel, Lang, Premium o. Ä.).

- Aktuelle Definition:
  - Pauschale Preise pro Video-Paket
  - Keine automatische Zusatzlogik
  - Keine Einzel-Clip-Abrechnung
- Diese Struktur ist **nicht final** und wird zu einem späteren Zeitpunkt überarbeitet.

**In dieser Version der Buchungsseite gilt:**

- Video-Services können gebucht werden
- Es gibt **keine Zusatzbuchung einzelner Clips**  
- Keine Verbindung zu FEX oder Bildauswahl-Logik
- Interne Notiz in der Doku: *„Video-Logik in v2 überarbeiten“*

---

## 8. Virtuelle Rundgänge

### 8.1 TML (Standard-Tour)

- **TML** ist die einzige aktive Position für virtuelle Rundgänge.
- Preis und Leistungsumfang werden im Preiskatalog definiert.
- TML steht für einen „normalen“ virtuellen Rundgang (Standardauflösung, Standard-Umfang).

### 8.2 Entfernte Tourtypen

Folgende Tour-Typen werden **komplett gestrichen**:

- **TFX** – Erweiterte Tour
- **THD** – Hochauflösende Tour

Diese Positionen:

- Werden aus `seed-services.ts` / Preisliste entfernt bzw. deaktiviert.
- Tauchen in der Buchungsseite nicht mehr auf.
- Werden in der weiteren Planung nicht berücksichtigt.

---

## 9. Bildoptimierung / Bearbeitungsoptionen (Kosmetik, Staging, etc.)

Hierunter fallen alle Leistungen, die **über das Standard-Editing** hinausgehen, z. B.:

- „Kosusche“ / intensive Bildoptimierung
- Entfernen von Möbeln / Objekten
- Teil-Räumung oder Voll-Räumung eines Raumes (virtuell)
- Virtuelles Staging

**Wichtige Regeln:**

1. **Keine Vorab-Buchung auf der Buchungsseite.**  
   Diese Optionen tauchen **nicht** im Buchungsformular auf.

2. **Zweifache Dokumentation:**
   - In der **Preisliste** als mögliche Zusatzleistungen mit Preisen
   - In der **Galerie** als Bearbeitungsoption pro Bild

3. **Aktivierung nur in der Galerie:**
   - Der Kunde sieht nach dem Shooting seine Bilder in der Galerie.
   - Dort kann er pro Bild auswählen, ob zusätzliche Bearbeitung gewünscht ist.
   - Die entsprechende Position wird dann mit in die Abrechnung aufgenommen.

Für die Buchungsseite reicht ein Hinweis auf „zusätzliche Bearbeitungsoptionen in der Galerie“.  
Die eigentliche Auswahl passiert **nicht** bei der Buchung.

---

## 10. Anfahrt & Service

### 10.1 Grundregel

- **Bis 40 km Umkreis** um Hamburg sind die Anfahrtskosten im Paket enthalten.
- Es gibt **keine** separate Region-Auswahl (HH/EXT/Berlin o. Ä.).
- Es gibt **keine** automatische Kilometerberechnung im System.

### 10.2 Entfernung > 40 km

- Für Entfernungen **über 40 km** gilt:
  - Es können **zusätzliche Fahrtkosten** anfallen.
  - Diese werden **immer vorab individuell abgesprochen** (telefonisch oder per E-Mail).
  - Es gibt **keine fixe, im System hinterlegte Pauschale**.
- Reise- und Übernachtungspauschalen entfallen aus der Spezifikation:
  - „Reise“ und „Übernachtung“ als eigene Positionen werden gestrichen.

Im UI wird das als Hinweistext kommuniziert, nicht als eigenes Formularfeld.

---

## 11. Kundendaten & Objektdaten

### 11.1 Pflichtfelder

**Kontaktinformationen:**

- `contactName` – Name des Maklers/Kunden (Pflichtfeld)
- `contactEmail` – E-Mail-Adresse (Pflichtfeld, validiert)
- `contactMobile` – Telefonnummer (Pflichtfeld, Format: `+49...`)

**Objektdaten:**

- `propertyName` – Interne Objektbezeichnung (Pflichtfeld)
  - z. B. „Helle 3-Zimmer-Wohnung Eimsbüttel“, „Objekt 4711 – Mühlenkamp“
- `propertyAddress` – Adresse der Immobilie (Pflichtfeld)

### 11.2 Terminauswahl

- `preferredDate` – Gewünschter Termin (Date-Picker)
- `preferredTime` – Gewünschte Uhrzeit (Time-Picker)

---

## 12. Preisberechnung

### 12.1 Formel

```text
Netto-Summe = Σ (Service-Preis × Quantity)
MwSt (19 %) = Netto-Summe × 0.19
Brutto-Summe = Netto-Summe + MwSt


12.2 Checkout-Summary
Die Zusammenfassung zeigt:
Netto-Gesamtbetrag
MwSt-Betrag (19 %)
Brutto-Gesamtbetrag (fett hervorgehoben)
Alle Preise werden im Backend als Cent gespeichert, z. B.:
57900 = 579,00 €

13. Backend-Integration
13.1 API Endpoint
POST /api/bookings
13.2 Beispiel-Payload
{
  "contactName": "Test Makler GmbH",
  "contactEmail": "makler@example.com",
  "contactMobile": "+49 170 1234567",
  "propertyName": "Einfamilienhaus Elbchaussee",
  "propertyAddress": "Elbchaussee 123, 22609 Hamburg",
  "preferredDate": "2025-11-20",
  "preferredTime": "14:00",
  "serviceSelections": {
    "F10": 1,
    "TML": 1
  },
  "totalNetPrice": 57900,
  "vatAmount": 11001,
  "grossAmount": 68901,
  "agbAccepted": true
}
Hinweise:
serviceSelections:
Key = Service-ID (z. B. F10, F15, F40, TML, VIDEO_SHORT, DRONE_BASIC etc.)
Value = Quantity (meist 0 oder 1, theoretisch >1 möglich)
FEX (Zusatzfoto) taucht in diesem Payload nur auf, wenn im weiteren Verlauf (Galerie) Zusatzbilder gekauft werden.
agbAccepted:
Admin-seitig: darf nur true gesetzt werden, wenn eine Einwilligung bereits vorliegt (Rahmenvertrag, frühere Zustimmung).
Kundenseitig: auf der öffentlichen Buchungsseite muss eine AGB-Checkbox implementiert sein.
13.3 Datenbankoperationen
1. Booking erstellen (bookings Tabelle)
Speichert:
Kundendaten
Objektdaten
Wunschtermin
Netto-, MwSt- und Bruttobeträge
Initialer Status: "pending"
2. BookingItems erstellen (bookingItems Tabelle)
Für jeden Service mit Quantity > 0
Referenz auf Service-ID und Booking-ID
3. Spätere Ergänzung (Galerie):
Zusatzbilder (FEX) und Bildbearbeitungsoptionen werden als weitere BookingItems oder OrderItems ergänzt, sobald der Kunde in der Galerie entsprechende Optionen auswählt.

14. SMS-Benachrichtigung
14.1 Twilio-Integration
Nach erfolgreichem Speichern der Buchung:
Es wird eine SMS an contactMobile gesendet.
Inhaltlich: Eingangsbestätigung, keine endgültige Terminbestätigung, da Status "pending" ist.
14.2 Beispiel-Text (neutral, nicht „bestätigt“)
Hallo [contactName],

Ihre Buchung ist bei uns eingegangen.
Gewünschter Termin: [preferredDate] um [preferredTime] Uhr.

Wir melden uns, falls es Rückfragen oder Terminänderungen gibt.

Viele Grüße
Ihr pix.immo Team
Später kann bei tatsächlicher Bestätigung ein weiterer Kommunikationskanal (E-Mail/SMS) verwendet werden, falls nötig.

15. Validierung
Zod-Schema (insertBookingSchema):
Pflichtfelder:
contactName, contactEmail, contactMobile
propertyName, propertyAddress
preferredDate, preferredTime
E-Mail: valides Format
Telefonnummer: muss angegeben sein, Formatprüfung (mindestens + + Landesvorwahl + Nummer)
serviceSelections:
Darf nicht leer sein
Mindestens ein Service mit Quantity > 0
Preisfelder:
totalNetPrice > 0
vatAmount >= 0
grossAmount > 0

16. Technische Struktur
Frontend: client/src/pages/admin-internal-booking.tsx
Backend-Routen: server/routes.ts (POST /api/bookings)
Schema: shared/schema.ts (bookings, bookingItems)
Storage: server/storage.ts (createBooking)
Notifications: server/notifications.ts (sendBookingConfirmationSMS)
Services / Preisliste: server/seed-services.ts

17. Testing (E2E)
E2E-Tests sollen erst angepasst/neu geschrieben werden, wenn die Buchungslogik vollständig steht.
Ziel-E2E-Szenario (wenn alles fertig):
1. Login als Admin
2. Navigation zu /admin/internal-booking
3. Auswahl von:
Mindestens einem Fotopaket (z. B. F15)
Optional TML und/oder Drohnenpaket
4. Ausfüllen aller Pflichtfelder (Kundendaten, Objektdaten, Termin)
5. Formular absenden
6. Prüfen:
Erfolgsmeldung im UI (Toast)
Eintrag in bookings und bookingItems
SMS an contactMobile mit neutraler Bestätigung
7. Sicherstellen, dass:
Keine Regionslogik mehr existiert
TFX/THD nicht angezeigt werden
FEX auf der Buchungsseite nicht aktiv auswählbar ist
